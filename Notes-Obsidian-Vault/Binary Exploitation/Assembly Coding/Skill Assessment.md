**Disassemble 'loaded_shellcode' and modify its assembly code to decode the shellcode, by adding a loop to 'xor' each 8-bytes on the stack with the key in 'rbx'.**

Disassembled shellcode:
`objdump -M intel -d loaded_shellcode --no-addresses --no-show-raw-insn`

```bash
loaded_shellcode:     file format elf64-x86-64


Disassembly of section .text:

<_start>:
        movabs rax,0xa284ee5c7cde4bd7
        push   rax
        movabs rax,0x935add110510849a
        push   rax
        movabs rax,0x10b29a9dab697500
        push   rax
        movabs rax,0x200ce3eb0d96459a
        push   rax
        movabs rax,0xe64c30e305108462
        push   rax
        movabs rax,0x69cd355c7c3e0c51
        push   rax
        movabs rax,0x65659a2584a185d6
        push   rax
        movabs rax,0x69ff00506c6c5000
        push   rax
        movabs rax,0x3127e434aa505681
        push   rax
        movabs rax,0x6af2a5571e69ff48
        push   rax
        movabs rax,0x6d179aaff20709e6
        push   rax
        movabs rax,0x9ae3f152315bf1c9
        push   rax
        movabs rax,0x373ab4bb0900179a
        push   rax
        movabs rax,0x69751244059aa2a3
        push   rax
        movabs rbx,0x2144d2144d2144d2
```

To correctly obtain the decoded shellcode, we need to loop and xor decode the code on the stack. On each iteration of the loop(14 total) we need to get the value stored in `$rdx`

To do this, let's first change all `movabs` instructions to `mov`:

The initial part of the code sets up the shellcode and the key:

```asm
global _start
section .text
_start:
mov rax,0xa284ee5c7cde4bd7
push rax
mov rax,0x935add110510849a
push rax
mov rax,0x10b29a9dab697500
push rax
mov rax,0x200ce3eb0d96459a
push rax
mov rax,0xe64c30e305108462
push rax
mov rax,0x69cd355c7c3e0c51
push rax
mov rax,0x65659a2584a185d6
push rax
mov rax,0x69ff00506c6c5000
push rax
mov rax,0x3127e434aa505681
push rax
mov rax,0x6af2a5571e69ff48
push rax
mov rax,0x6d179aaff20709e6
push rax
mov rax,0x9ae3f152315bf1c9
push rax
mov rax,0x373ab4bb0900179a
push rax
mov rax,0x69751244059aa2a3
push rax
mov rbx,0x2144d2144d2144d2
```

`mov rax, <value` and `push rax` instructions load a value into the `rax` register then push it onto the stack.
- This sequence stores the encoded shellcode values on the stack.

`mov rbx, 0x2144d2144d2144d2` sets `rbx` with the decoding key which will be used to decode the shellcode by XORing.


**Decoding phase**
```
mov rcx, 14 ; sets loop counter to 14
lea rdx, [rsp] ; loads the current value of the stack pointer rsp into rdx
			   ; rdx now points to the top of the stack
loopfun:       ; start of the loop
xor [rdx], rbx ; performs XOR between the value pointed to by rdx and val in rbx,                ; stored in rbx
add rdx, 8     ; increments rdx by 8
loop loopfun   ; decrements the `rcx` register by 1 and checks if `rcx` is zero.
```

Now, to get the flag after assembling the new binary:
1. `gdb ./load`
2. `disas _start`
3. Set breakpoint after the XOR operation
4. Get value stored in `rdx` on each loop iteration
5. Concatenate shellcode and run with `load_shellcode.py`

```
(gdb) b *0x00000000004010b0
Breakpoint 1 at 0x4010b0
(gdb) commands
Type commands for breakpoint(s) 1, one per line.
End with a line saying just "end".
>x/14gx $rdx
>continue
>end
(gdb) r
Starting program: /home/epardo1742/hack-the-box/Academy/x86-assembly/load

Breakpoint 1, 0x00000000004010b0 in loopfun ()
0x7fffffffe0a0: 0x4831c05048bbe671      0x373ab4bb0900179a
0x7fffffffe0b0: 0x9ae3f152315bf1c9      0x6d179aaff20709e6
0x7fffffffe0c0: 0x6af2a5571e69ff48      0x3127e434aa505681
0x7fffffffe0d0: 0x69ff00506c6c5000      0x65659a2584a185d6
0x7fffffffe0e0: 0x69cd355c7c3e0c51      0xe64c30e305108462
0x7fffffffe0f0: 0x200ce3eb0d96459a      0x10b29a9dab697500
0x7fffffffe100: 0x935add110510849a      0xa284ee5c7cde4bd7

Breakpoint 1, 0x00000000004010b0 in loopfun ()
0x7fffffffe0a8: 0x167e66af44215348      0x9ae3f152315bf1c9
0x7fffffffe0b8: 0x6d179aaff20709e6      0x6af2a5571e69ff48
0x7fffffffe0c8: 0x3127e434aa505681      0x69ff00506c6c5000
0x7fffffffe0d8: 0x65659a2584a185d6      0x69cd355c7c3e0c51
0x7fffffffe0e8: 0xe64c30e305108462      0x200ce3eb0d96459a
0x7fffffffe0f8: 0x10b29a9dab697500      0x935add110510849a
0x7fffffffe108: 0xa284ee5c7cde4bd7      0x0000000000000001

Breakpoint 1, 0x00000000004010b0 in loopfun ()
0x7fffffffe0b0: 0xbba723467c7ab51b      0x6d179aaff20709e6
0x7fffffffe0c0: 0x6af2a5571e69ff48      0x3127e434aa505681
0x7fffffffe0d0: 0x69ff00506c6c5000      0x65659a2584a185d6
0x7fffffffe0e0: 0x69cd355c7c3e0c51      0xe64c30e305108462
0x7fffffffe0f0: 0x200ce3eb0d96459a      0x10b29a9dab697500
0x7fffffffe100: 0x935add110510849a      0xa284ee5c7cde4bd7
0x7fffffffe110: 0x0000000000000001      0x00007fffffffe387

Breakpoint 1, 0x00000000004010b0 in loopfun ()
0x7fffffffe0b8: 0x4c5348bbbf264d34      0x6af2a5571e69ff48
0x7fffffffe0c8: 0x3127e434aa505681      0x69ff00506c6c5000
0x7fffffffe0d8: 0x65659a2584a185d6      0x69cd355c7c3e0c51
0x7fffffffe0e8: 0xe64c30e305108462      0x200ce3eb0d96459a
0x7fffffffe0f8: 0x10b29a9dab697500      0x935add110510849a
0x7fffffffe108: 0xa284ee5c7cde4bd7      0x0000000000000001
0x7fffffffe118: 0x00007fffffffe387      0x0000000000000000

Breakpoint 1, 0x00000000004010b0 in loopfun ()
0x7fffffffe0c0: 0x4bb677435348bb9a      0x3127e434aa505681
0x7fffffffe0d0: 0x69ff00506c6c5000      0x65659a2584a185d6
0x7fffffffe0e0: 0x69cd355c7c3e0c51      0xe64c30e305108462
0x7fffffffe0f0: 0x200ce3eb0d96459a      0x10b29a9dab697500
0x7fffffffe100: 0x935add110510849a      0xa284ee5c7cde4bd7
0x7fffffffe110: 0x0000000000000001      0x00007fffffffe387
0x7fffffffe120: 0x0000000000000000      0x00007fffffffe3bf

Breakpoint 1, 0x00000000004010b0 in loopfun ()
0x7fffffffe0c8: 0x10633620e7711253      0x69ff00506c6c5000
0x7fffffffe0d8: 0x65659a2584a185d6      0x69cd355c7c3e0c51
0x7fffffffe0e8: 0xe64c30e305108462      0x200ce3eb0d96459a
0x7fffffffe0f8: 0x10b29a9dab697500      0x935add110510849a
0x7fffffffe108: 0xa284ee5c7cde4bd7      0x0000000000000001
0x7fffffffe118: 0x00007fffffffe387      0x0000000000000000
0x7fffffffe128: 0x00007fffffffe3bf      0x00007fffffffe3cf

Breakpoint 1, 0x00000000004010b0 in loopfun ()
0x7fffffffe0d0: 0x48bbd244214d14d2      0x65659a2584a185d6
0x7fffffffe0e0: 0x69cd355c7c3e0c51      0xe64c30e305108462
0x7fffffffe0f0: 0x200ce3eb0d96459a      0x10b29a9dab697500
0x7fffffffe100: 0x935add110510849a      0xa284ee5c7cde4bd7
0x7fffffffe110: 0x0000000000000001      0x00007fffffffe387
0x7fffffffe120: 0x0000000000000000      0x00007fffffffe3bf
0x7fffffffe130: 0x00007fffffffe3cf      0x00007fffffffe3dc

Breakpoint 1, 0x00000000004010b0 in loopfun ()
0x7fffffffe0d8: 0x44214831c980c104      0x69cd355c7c3e0c51
0x7fffffffe0e8: 0xe64c30e305108462      0x200ce3eb0d96459a
0x7fffffffe0f8: 0x10b29a9dab697500      0x935add110510849a
0x7fffffffe108: 0xa284ee5c7cde4bd7      0x0000000000000001
0x7fffffffe118: 0x00007fffffffe387      0x0000000000000000
0x7fffffffe128: 0x00007fffffffe3bf      0x00007fffffffe3cf
0x7fffffffe138: 0x00007fffffffe3dc      0x00007fffffffe746

Breakpoint 1, 0x00000000004010b0 in loopfun ()
0x7fffffffe0e0: 0x4889e748311f4883      0xe64c30e305108462
0x7fffffffe0f0: 0x200ce3eb0d96459a      0x10b29a9dab697500
0x7fffffffe100: 0x935add110510849a      0xa284ee5c7cde4bd7
0x7fffffffe110: 0x0000000000000001      0x00007fffffffe387
0x7fffffffe120: 0x0000000000000000      0x00007fffffffe3bf
0x7fffffffe130: 0x00007fffffffe3cf      0x00007fffffffe3dc
0x7fffffffe140: 0x00007fffffffe746      0x00007fffffffe75a

Breakpoint 1, 0x00000000004010b0 in loopfun ()
0x7fffffffe0e8: 0xc708e2f74831c0b0      0x200ce3eb0d96459a
0x7fffffffe0f8: 0x10b29a9dab697500      0x935add110510849a
0x7fffffffe108: 0xa284ee5c7cde4bd7      0x0000000000000001
0x7fffffffe118: 0x00007fffffffe387      0x0000000000000000
0x7fffffffe128: 0x00007fffffffe3bf      0x00007fffffffe3cf
0x7fffffffe138: 0x00007fffffffe3dc      0x00007fffffffe746
0x7fffffffe148: 0x00007fffffffe75a      0x00007fffffffe77a

Breakpoint 1, 0x00000000004010b0 in loopfun ()
0x7fffffffe0f0: 0x014831ff40b70148      0x10b29a9dab697500
0x7fffffffe100: 0x935add110510849a      0xa284ee5c7cde4bd7
0x7fffffffe110: 0x0000000000000001      0x00007fffffffe387
0x7fffffffe120: 0x0000000000000000      0x00007fffffffe3bf
0x7fffffffe130: 0x00007fffffffe3cf      0x00007fffffffe3dc
0x7fffffffe140: 0x00007fffffffe746      0x00007fffffffe75a
0x7fffffffe150: 0x00007fffffffe77a      0x00007fffffffe785

Breakpoint 1, 0x00000000004010b0 in loopfun ()
0x7fffffffe0f8: 0x31f64889e64831d2      0x935add110510849a
0x7fffffffe108: 0xa284ee5c7cde4bd7      0x0000000000000001
0x7fffffffe118: 0x00007fffffffe387      0x0000000000000000
0x7fffffffe128: 0x00007fffffffe3bf      0x00007fffffffe3cf
0x7fffffffe138: 0x00007fffffffe3dc      0x00007fffffffe746
0x7fffffffe148: 0x00007fffffffe75a      0x00007fffffffe77a
0x7fffffffe158: 0x00007fffffffe785      0x00007fffffffe79f

Breakpoint 1, 0x00000000004010b0 in loopfun ()
0x7fffffffe100: 0xb21e0f054831c048      0xa284ee5c7cde4bd7
0x7fffffffe110: 0x0000000000000001      0x00007fffffffe387
0x7fffffffe120: 0x0000000000000000      0x00007fffffffe3bf
0x7fffffffe130: 0x00007fffffffe3cf      0x00007fffffffe3dc
0x7fffffffe140: 0x00007fffffffe746      0x00007fffffffe75a
0x7fffffffe150: 0x00007fffffffe77a      0x00007fffffffe785
0x7fffffffe160: 0x00007fffffffe79f      0x00007fffffffe7c7

Breakpoint 1, 0x00000000004010b0 in loopfun ()
0x7fffffffe108: 0x83c03c4831ff0f05      0x0000000000000001
0x7fffffffe118: 0x00007fffffffe387      0x0000000000000000
0x7fffffffe128: 0x00007fffffffe3bf      0x00007fffffffe3cf
0x7fffffffe138: 0x00007fffffffe3dc      0x00007fffffffe746
0x7fffffffe148: 0x00007fffffffe75a      0x00007fffffffe77a
0x7fffffffe158: 0x00007fffffffe785      0x00007fffffffe79f
0x7fffffffe168: 0x00007fffffffe7c7      0x00007fffffffe7df

Program received signal SIGSEGV, Segmentation fault.
0x00000000004010b6 in ?? ()
(gdb) q
```

```bash
python3 load_shellcode.py '4831c05048bbe671167e66af44215348bba723467c7ab51b4c5348bbbf264d344bb677435348bb9a10633620e771125348bbd244214d14d244214831c980c1044889e748311f4883c708e2f74831c0b0014831ff40b7014831f64889e64831d2b21e0f054831c04883c03c4831ff0f05'
HTB{4553mbly_d3bugg1ng_m4573r}
```

